

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>mcnp Package &mdash; UW-R2S - CNERG</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="UW-R2S - CNERG" href="../index.html" />
    <link rel="up" title="r2s Package" href="r2s.html" />
    <link rel="prev" title="io Package" href="r2s.io.html" /> 
  </head>
  <body> 
<div id="page-div" class="page">
<div id="header"><a id="uwhome" href="http://www.wisc.edu"><img src="http://cnergdata.engr.wisc.edu/_static/images/wordmark.gif" alt="University of Wisconsin–Madison" width="260" height="11" /></a> <a id="crest" href="http://www.wisc.edu"><img src="http://cnergdata.engr.wisc.edu/_static/images/crest.png" alt="" width="70" height="106" /></a>
    <h1 id="siteTitle"><a href="/"><span>UW-R2S</span></a></h1>
    <div id="tagline"><span>3-D Neutron Activation Workflow</span></div>
    <ul id="globalnav">
      <li id="uwsearch"><a href="http://www.wisc.edu/search/">UW Search</a></li>
      <li><a href="http://my.wisc.edu">My UW</a></li>
      <li><a href="http://map.wisc.edu">Map</a></li>
      <li id="last_tool"><a href="http://www.today.wisc.edu">Calendar</a></li>
    </ul>
    <form role="search" action="../search.html" method="get" id="cse-search-box">
      <div>
      <label class="screen-reader-text" for="q">Search for:</label>
      <input type="text" id="q" name="q" value="Enter keywords here...." />
      <input type="submit" id="sa" value="Search" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
      </div>
    </form>
<script type="text/javascript">$('#searchbox').show(0);</script>
</div>

    <div id="nav" class="main-menu-container">
      <ul id="menu-main" class="sf-menu">
        <li class="menu-item"><a href="../index.html">UW-R2S</a></li>
        <li class="menu-item" style="margin-right: 10px">
          <a href="r2s.io.html" title="io Package"
             accesskey="P">previous</a>
          </li>
        <li class="menu-item" >
          <a href="../np-modindex.html" title="Python Module Index"
             >modules</a>
          </li>
        <li class="menu-item" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a>
          </li>
        <li class="menu-item" >
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a>
          </li>
          <li class="menu-item"><a href="modules.html" >r2s</a></li>
          <li class="menu-item"><a href="r2s.html" accesskey="U">r2s Package</a></li> 
      </ul>
    </div>
  <div id="c_container"> 
<div id="sidebar">
 <div id="sidebar_section"> <ul>
<li><a class="reference internal" href="#">mcnp Package</a><ul>
<li><a class="reference internal" href="#module-r2s.mcnp.source_gamma_doc"><tt class="docutils literal"><span class="pre">source_gamma_doc</span></tt> Module</a><ul>
<li><a class="reference internal" href="#mcnp-source-source-gamma-f90">mcnp_source/source_gamma.F90</a><ul>
<li><a class="reference internal" href="#summary">Summary</a></li>
<li><a class="reference internal" href="#header">Header</a></li>
<li><a class="reference internal" href="#voxel-lines">Voxel lines</a></li>
<li><a class="reference internal" href="#other-notes">Other notes</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
 </div>
</div> 
    <div id="content" class="inline-block">
          <div class="post">
            
  <div class="section" id="mcnp-package">
<h1>mcnp Package<a class="headerlink" href="#mcnp-package" title="Permalink to this headline">¶</a></h1>
<div class="section" id="module-r2s.mcnp.source_gamma_doc">
<span id="source-gamma-doc-module"></span><h2><tt class="xref py py-mod docutils literal"><span class="pre">source_gamma_doc</span></tt> Module<a class="headerlink" href="#module-r2s.mcnp.source_gamma_doc" title="Permalink to this headline">¶</a></h2>
<div class="section" id="mcnp-source-source-gamma-f90">
<h3>mcnp_source/source_gamma.F90<a class="headerlink" href="#mcnp-source-source-gamma-f90" title="Permalink to this headline">¶</a></h3>
<div class="section" id="summary">
<h4>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h4>
<p>Adapted from source routine (source_gamma_meshtal2.F90) provided by 
Dieter Leichtle from KIT.
Changes have been made by Eric Relson with UW-Madison/CNERG goals in mind.</p>
<p>This source file implements photon source sampling on a cartesian mesh.
Two photon position sampling methods are avaiable:</p>
<ol class="arabic simple">
<li>voxel sampling</li>
<li>uniform sampling</li>
</ol>
<p>Subroutine source reads in the file &#8216;gammas&#8217; from the directory
that MCNP is being run in.  The gammas file has two parts - a header and
a listing of information for each voxel.</p>
</div>
<div class="section" id="header">
<h4>Header<a class="headerlink" href="#header" title="Permalink to this headline">¶</a></h4>
<p>The header starts with 5 lines containing the following information:</p>
<ol class="arabic simple">
<li>Number of intervals for x, y, z</li>
<li>Mesh coordinates for x direction</li>
<li>Mesh coordinates for y direction</li>
<li>Mesh coordinates for z direction</li>
<li>List of activated materials; use of this info requires the m parameter.</li>
</ol>
<p>These are optionally followed by a parameters line (line 6). This line begins 
with a &#8216;p&#8217;, and single character parameters, separated by spaces, follow.
The currently supported parameters are (order does not matter):</p>
<ul class="simple">
<li>u: enable uniform sampling</li>
<li>v: enable voxel sampling</li>
<li>m: enable source position rejection based on activated materials</li>
<li>e: read in custom list of energy bin boundaries</li>
<li>d: enable debug output to file source_debug. Dumps xxx,yyy,zzz,wgt every 10k
particles</li>
<li>c: treat bins for each voxel as cumulative</li>
<li>b: flag indicating bias values are used; only valid with voxel sampling</li>
</ul>
<p>An example parameter line: <cite>p u d m e</cite></p>
<p>If the parameters line is not present, the default is to set u, m, c as True.
If &#8216;e&#8217; parameter exists, line 7 lists custom energy group boundaries, space
delimited. This line start with the integer number of groups. The default
energy bins are a 42 group structure.
All subsequent lines are for voxels.</p>
</div>
<div class="section" id="voxel-lines">
<h4>Voxel lines<a class="headerlink" href="#voxel-lines" title="Permalink to this headline">¶</a></h4>
<p>Two formats are supported, cumulative bins, or non-cumulative bins. In both
cases, lines list bin values from low energy to high energy, delimited by
spaces.</p>
<p>Note that the normalization for voxel and uniform sampling is different, and 
will result in differing gammas files. In general, for voxel sampling,
normalization is based on the average source strength in photons/voxel/s; 
For uniform sampling, we want average source strength in phtons/cm3/s.</p>
<p>As an exercise to verify that the gammas files are being generated correctly,
do a test problem and verify that you get the same average energy per source
particle in all test cases, and that all uniform sampling test cases have a
weight of 1.0 per source particle. (See the summary table in MCNP output)</p>
<p>Note that correct normalization also depends on whether
material rejection is being used.</p>
<p>In either case, the last bin can be followed by a bias value for the voxel.
An arbitrary range of bias values can be used since the source routine does
the necessary re-normalization for voxel sampling.</p>
</div>
<div class="section" id="other-notes">
<h4>Other notes<a class="headerlink" href="#other-notes" title="Permalink to this headline">¶</a></h4>
<p>Voxel sampling and energy sampling use a sampling technique referred to as
&#8216;alias discrete&#8217; or &#8216;alias table&#8217; sampling.  This provides efficiency
benefits over &#8216;direct discrete&#8217; sampling. Creation of the alias tables uses
the heap sort algorithm.</p>
<dl class="function">
<dt id="r2s.mcnp.source_gamma_doc.gen_alias_table">
<tt class="descclassname">r2s.mcnp.source_gamma_doc.</tt><tt class="descname">gen_alias_table</tt><big>(</big><big>)</big><a class="headerlink" href="#r2s.mcnp.source_gamma_doc.gen_alias_table" title="Permalink to this definition">¶</a></dt>
<dd><p>Subroutine generates an alias table</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters :</th><td class="field-body"><p class="first"><strong>bins</strong> : list of [int, float] pairs (INOUT)</p>
<blockquote>
<div><p>PDF&#8217;s bin indices and absolute probabilities.</p>
</div></blockquote>
<p><strong>pairs</strong> : list of [int, int] pairs (OUT)</p>
<blockquote>
<div><p>Filled with pairs of bin and alias indices.</p>
</div></blockquote>
<p><strong>probs_list</strong> : list of floats (OUT)</p>
<blockquote>
<div><p>List of probabilities for first bin in each alias pair.</p>
</div></blockquote>
<p><strong>len</strong> : int</p>
<blockquote class="last">
<div><p>Number of bins in the alias table</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>note that bins is a list of pairs of the form (probability,value)
The sum of the probabilities in bins must be 1.</p>
<p>We implement the alias table creation algorithm described by Vose (1991).
For reference:</p>
<div class="highlight-python"><pre>Vose:      Code:
p_j        bins(j,1)
large_l    ind_large(l)
small_s    ind_small(s)
prob_j     probs_list(j)
'bin' j    pairs(j,1)
alias_j    pairs(j,2)</pre>
</div>
</dd></dl>

<dl class="function">
<dt id="r2s.mcnp.source_gamma_doc.gen_erg_alias_table">
<tt class="descclassname">r2s.mcnp.source_gamma_doc.</tt><tt class="descname">gen_erg_alias_table</tt><big>(</big><big>)</big><a class="headerlink" href="#r2s.mcnp.source_gamma_doc.gen_erg_alias_table" title="Permalink to this definition">¶</a></dt>
<dd><p>Create alias table for energy bins of a single voxel</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters :</th><td class="field-body"><p class="first"><strong>len</strong> : int</p>
<blockquote>
<div><p>length of ergsList</p>
</div></blockquote>
<p><strong>ergsList</strong> : list of floats</p>
<blockquote>
<div><p>ergsList values must total 1!</p>
</div></blockquote>
<p><strong>myErgPairs</strong> : list of [int, int] (OUT)</p>
<blockquote>
<div><p>The generated pairs of bin and alias indices for the energy PDF</p>
</div></blockquote>
<p><strong>myErgPairsProbabilities</strong> : list of floats (OUT)</p>
<blockquote class="last">
<div><p>List of probabilities for first bin in each alias pair.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="r2s.mcnp.source_gamma_doc.gen_voxel_alias_table">
<tt class="descclassname">r2s.mcnp.source_gamma_doc.</tt><tt class="descname">gen_voxel_alias_table</tt><big>(</big><big>)</big><a class="headerlink" href="#r2s.mcnp.source_gamma_doc.gen_voxel_alias_table" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate alias table for voxels in the problem</p>
<p class="rubric">Notes</p>
<p>The resulting alias table is stored in lists <cite>pairs</cite> and <cite>pairsProbabilities</cite>.</p>
<p>tot_list does not have to be normalized prior to calling this subroutine</p>
</dd></dl>

<dl class="function">
<dt id="r2s.mcnp.source_gamma_doc.print_debug">
<tt class="descclassname">r2s.mcnp.source_gamma_doc.</tt><tt class="descname">print_debug</tt><big>(</big><big>)</big><a class="headerlink" href="#r2s.mcnp.source_gamma_doc.print_debug" title="Permalink to this definition">¶</a></dt>
<dd><p>Subroutine stores debug info in an array, and write the array to a file
after every 10000 particles.</p>
</dd></dl>

<dl class="function">
<dt id="r2s.mcnp.source_gamma_doc.read_custom_ergs">
<tt class="descclassname">r2s.mcnp.source_gamma_doc.</tt><tt class="descname">read_custom_ergs</tt><big>(</big><big>)</big><a class="headerlink" href="#r2s.mcnp.source_gamma_doc.read_custom_ergs" title="Permalink to this definition">¶</a></dt>
<dd><p>Read line from gammas file to get a custom set of energy bins</p>
</dd></dl>

<dl class="function">
<dt id="r2s.mcnp.source_gamma_doc.read_header">
<tt class="descclassname">r2s.mcnp.source_gamma_doc.</tt><tt class="descname">read_header</tt><big>(</big><big>)</big><a class="headerlink" href="#r2s.mcnp.source_gamma_doc.read_header" title="Permalink to this definition">¶</a></dt>
<dd><p>Read in first 5 lines of gammas file, as well as comment lines</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters :</th><td class="field-body"><p class="first"><strong>myunit</strong> : int</p>
<blockquote class="last">
<div><p>Unit number for an opened file (i.e. file &#8216;gammas&#8217;)</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>First 5 non-comment  lines contain the x,y,z mesh intervals
and the list of active materials</p>
<p>Also skips over any comment lines (beginning with # character) at start of
file.</p>
</dd></dl>

<dl class="function">
<dt id="r2s.mcnp.source_gamma_doc.read_params">
<tt class="descclassname">r2s.mcnp.source_gamma_doc.</tt><tt class="descname">read_params</tt><big>(</big><big>)</big><a class="headerlink" href="#r2s.mcnp.source_gamma_doc.read_params" title="Permalink to this definition">¶</a></dt>
<dd><p>Read in the parameters line, if there is one.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters :</th><td class="field-body"><p class="first"><strong>myunit</strong> : int</p>
<blockquote class="last">
<div><p>Unit number for an opened file (i.e. file &#8216;gammas&#8217;)</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>Line should start with a &#8216;p&#8217; and have single characters
that are space delimited.</p>
<p>Set various parameters to 1 (true) if they exist.</p>
</dd></dl>

<dl class="function">
<dt id="r2s.mcnp.source_gamma_doc.sample_erg">
<tt class="descclassname">r2s.mcnp.source_gamma_doc.</tt><tt class="descname">sample_erg</tt><big>(</big><big>)</big><a class="headerlink" href="#r2s.mcnp.source_gamma_doc.sample_erg" title="Permalink to this definition">¶</a></dt>
<dd><p>Sample the alias table of energy bins for the selected voxel.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters :</th><td class="field-body"><p class="first"><strong>myerg</strong> : float (OUT)</p>
<blockquote>
<div><p>Sampled energy is stored in this variable</p>
</div></blockquote>
<p><strong>myvoxel</strong> : int</p>
<blockquote>
<div><p>Index of sampled voxel</p>
</div></blockquote>
<p><strong>n_grp</strong> : int</p>
<blockquote>
<div><p>Number of energy groups</p>
</div></blockquote>
<p><strong>n_vox</strong> : int</p>
<blockquote>
<div><p>Length of next two arrays</p>
</div></blockquote>
<p><strong>probList</strong> : list of lists of floats</p>
<blockquote>
<div><p>List of alias pair probabilities for energy PDF, for each voxel</p>
</div></blockquote>
<p><strong>pairsList</strong> : list of lists of [int, int] pairs</p>
<blockquote class="last">
<div><p>Bin and alias indices for energy group, for each voxel</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="r2s.mcnp.source_gamma_doc.sample_within_voxel">
<tt class="descclassname">r2s.mcnp.source_gamma_doc.</tt><tt class="descname">sample_within_voxel</tt><big>(</big><big>)</big><a class="headerlink" href="#r2s.mcnp.source_gamma_doc.sample_within_voxel" title="Permalink to this definition">¶</a></dt>
<dd><p>Samples within the extents of a voxel</p>
<p class="rubric">Notes</p>
<p>ii, jj, kk are presumed to have been already determined.</p>
</dd></dl>

<dl class="function">
<dt id="r2s.mcnp.source_gamma_doc.source">
<tt class="descclassname">r2s.mcnp.source_gamma_doc.</tt><tt class="descname">source</tt><big>(</big><big>)</big><a class="headerlink" href="#r2s.mcnp.source_gamma_doc.source" title="Permalink to this definition">¶</a></dt>
<dd><p>Subroutine manages sampling of photons on mesh</p>
<p>Adapted from dummy source.F90 file.</p>
<p class="rubric">Notes</p>
<p>if nsr=0, subroutine source must be furnished by the user.
at entrance, a random set of uuu,vvv,www has been defined.  the
following variables must be defined within the subroutine:
xxx,yyy,zzz,icl,jsu,erg,wgt,tme and possibly ipt,uuu,vvv,www.
subroutine srcdx may also be needed.</p>
</dd></dl>

<dl class="function">
<dt id="r2s.mcnp.source_gamma_doc.source_setup">
<tt class="descclassname">r2s.mcnp.source_gamma_doc.</tt><tt class="descname">source_setup</tt><big>(</big><big>)</big><a class="headerlink" href="#r2s.mcnp.source_gamma_doc.source_setup" title="Permalink to this definition">¶</a></dt>
<dd><p>Subroutine handles parsing of the &#8216;gammas&#8217; file and related initializations</p>
</dd></dl>

<dl class="function">
<dt id="r2s.mcnp.source_gamma_doc.uniform_sample">
<tt class="descclassname">r2s.mcnp.source_gamma_doc.</tt><tt class="descname">uniform_sample</tt><big>(</big><big>)</big><a class="headerlink" href="#r2s.mcnp.source_gamma_doc.uniform_sample" title="Permalink to this definition">¶</a></dt>
<dd><p>Uniformly sample photon position in the entire volume of the mesh tally.</p>
</dd></dl>

<dl class="function">
<dt id="r2s.mcnp.source_gamma_doc.voxel_sample">
<tt class="descclassname">r2s.mcnp.source_gamma_doc.</tt><tt class="descname">voxel_sample</tt><big>(</big><big>)</big><a class="headerlink" href="#r2s.mcnp.source_gamma_doc.voxel_sample" title="Permalink to this definition">¶</a></dt>
<dd><p>Sample photon position from alias table of voxels.</p>
</dd></dl>

</div>
</div>
</div>
</div>


          </div>
      </div>

    </div>
</div>
    <div id="footer">
      <p>
        &copy; Copyright 2013, CNERG.
      </p>
      <p>
      Last updated on Jan 24, 2013.
      </p>
      <p>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
      </p>
    </div>
  </body>
</html>